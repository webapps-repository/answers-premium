// /api/utils/generatePdf.js
import PDFDocument from "pdfkit";
import getStream from "get-stream";

export async function generatePdfBuffer({
  fullName,
  birthdate,
  birthTime,
  birthPlace,
  question,
  answer,
  astrology,
  numerology,
  palmistry,
}) {
  const doc = new PDFDocument({ margin: 50 });
  const chunks = [];

  doc.on("data", (chunk) => chunks.push(chunk));
  doc.on("end", () => console.log("âœ… PDF generation complete"));

  // --- ðŸŸ£ Title ---
  doc
    .fontSize(22)
    .fillColor("#4B0082")
    .text("ðŸ”® Spiritual Report & Guidance", { align: "center" })
    .moveDown(1.5);

  // --- ðŸ§˜ Personal Info ---
  doc
    .fontSize(14)
    .fillColor("#000")
    .text(`ðŸ‘¤ Name: ${fullName}`)
    .moveDown(0.2)
    .text(`ðŸ“… Birth Date: ${birthdate}`)
    .moveDown(0.2)
    .text(`â° Birth Time: ${birthTime || "Unknown"}`)
    .moveDown(0.2)
    .text(`ðŸŒ Birth Place: ${birthPlace}`)
    .moveDown(0.2)
    .text(`ðŸ’­ Question: ${question || "No question provided."}`)
    .moveDown(1.2);

  // --- Divider helper ---
  const divider = (title, color = "#4B0082") => {
    doc
      .fontSize(16)
      .fillColor(color)
      .text(title, { underline: true })
      .moveDown(0.5);
  };

  // --- ðŸŒ  Answer Section ---
  divider("ðŸ’« Answer");
  doc
    .fontSize(12)
    .fillColor("#333")
    .text(answer || "No answer available.", { align: "left" })
    .moveDown(1.2);

  // --- ðŸŒŸ Astrology Section ---
  divider("ðŸŒŸ Astrology Insights");
  doc
    .fontSize(12)
    .fillColor("#333")
    .text(astrology || "No astrology insights available.", { align: "left" })
    .moveDown(1.2);

  // --- ðŸ”¢ Numerology Section ---
  divider("ðŸ”¢ Numerology Insights");
  doc
    .fontSize(12)
    .fillColor("#333")
    .text(numerology || "No numerology insights available.", { align: "left" })
    .moveDown(1.2);

  // --- âœ‹ Palmistry Section ---
  divider("âœ‹ Palmistry Insights");
  doc
    .fontSize(12)
    .fillColor("#333")
    .text(palmistry || "No palmistry insights available.", { align: "left" })
    .moveDown(2);

  // --- âœ¨ Footer ---
  doc
    .fontSize(10)
    .fillColor("#777")
    .text(
      "âœ¨ This personalized report was generated by Hazcam Spiritual Systems using astrological, numerological, and palmistry insights.",
      { align: "center" }
    );

  doc.end();
  return await getStream.buffer(doc);
}
